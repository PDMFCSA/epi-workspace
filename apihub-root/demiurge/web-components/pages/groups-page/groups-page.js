const mockData = {
    administrationGroup: [
        {
            username: 'DSU_Fabric/AdminWarrior',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminWarrior',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminMage',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminMage',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminRogue',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminRogue',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminPaladin',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminPaladin',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminCleric',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminCleric',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminBard',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminBard',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminDruid',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminDruid',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminSorcerer',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminSorcerer',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminNecromancer',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminNecromancer',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminMonk',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminMonk',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminRanger',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminRanger',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminKnight',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminKnight',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminBarbarian',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminBarbarian',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminAssassin',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminAssassin',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminWizard',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminWizard',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminWarlock',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminWarlock',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminBerserker',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminBerserker',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminTemplar',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminTemplar',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminCrusader',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminCrusader',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        },
        {
            username: 'DSU_Fabric/AdminWitch',
            DID: 'did:ssi:name:vault:DSU_Fabric/AdminWitch',
            group: 'ePI Administration Group',
            groupDID: 'did:ssi:group:vault:ePI_Administration_Group'
        }
    ],
    writeGroup: [
        {
            username: 'DSU_Fabric/WriteWarrior',
            DID: 'did:ssi:name:vault:DSU_Fabric/WriteWarrior',
            group: 'ePI Write Group',
            groupDID: 'did:ssi:group:vault:ePI_Write_Group'
        },
        {
            username: 'DSU_Fabric/WriteMage',
            DID: 'did:ssi:name:vault:DSU_Fabric/WriteMage',
            group: 'ePI Write Group',
            groupDID: 'did:ssi:group:vault:ePI_Write_Group'
        },
        {
            username: 'DSU_Fabric/WriteRogue',
            DID: 'did:ssi:name:vault:DSU_Fabric/WriteRogue',
            group: 'ePI Write Group',
            groupDID: 'did:ssi:group:vault:ePI_Write_Group'
        },
        {
            username: 'DSU_Fabric/WritePaladin',
            DID: 'did:ssi:name:vault:DSU_Fabric/WritePaladin',
            group: 'ePI Write Group',
            groupDID: 'did:ssi:group:vault:ePI_Write_Group'
        },
        {
            username: 'DSU_Fabric/WriteCleric',
            DID: 'did:ssi:name:vault:DSU_Fabric/WriteCleric',
            group: 'ePI Write Group',
            groupDID: 'did:ssi:group:vault:ePI_Write_Group'
        },
        {
            username: 'DSU_Fabric/WriteBard',
            DID: 'did:ssi:name:vault:DSU_Fabric/WriteBard',
            group: 'ePI Write Group',
            groupDID: 'did:ssi:group:vault:ePI_Write_Group'
        },
        {
            username: 'DSU_Fabric/WriteDruid',
            DID: 'did:ssi:name:vault:DSU_Fabric/WriteDruid',
            group: 'ePI Write Group',
            groupDID: 'did:ssi:group:vault:ePI_Write_Group'
        },
    ],
    readGroup: [
    ]
};

const groupNames = {
    Administration: "ePI Administration Group",
    Write: "ePI Write Group",
    Read: "ePI Read Group"
}

export class GroupsPage {
    constructor(element, invalidate) {
        this.element = element;
        this.invalidate = invalidate;
        this.invalidate(async () => {
            this.groupMembers = await this.getGroupData("Administration"); //replace with API call
        });
    }

    getGroupData(groupId) {
        const getAdministrationGroupMembers = () => {
            return mockData["administrationGroup"]||[]
        }
        const getWriteGroupMembers = () => {
            return mockData["writeGroup"]||[]
        }
        const getReadGroupMembers = () => {
            return mockData["readGroup"]||[]
        }
        switch (groupId) {
            case "Administration":
                return getAdministrationGroupMembers();
            case "Write":
                return getWriteGroupMembers();
            case "Read":
                return getReadGroupMembers();
            default:
                return getAdministrationGroupMembers();
        }
    }

    beforeRender() {
        const renderAdministrationGroup = () => {
            this.dataRecoveryButton="";
        }
        const renderWriteGroup = () => {
           this.dataRecoveryButton=`
            <button class="add-member-button" id="data-recovery-button" data-local-action="openDataRecoveryKeyModal">
                <span class="member-button-label">Data Recovery Key</span>
            </button>
        `
        }
        const renderReadGroup = () => {
            this.dataRecoveryButton="";
        }
        switch (this.selectedTab) {
            case "Administration":
                renderAdministrationGroup()
                break;
            case "Write":
                renderWriteGroup()
                break;
            case "Read":
                renderReadGroup()
                break;
            default:
                this.selectedTab = "Administration";
                renderAdministrationGroup()
        }
        this.groupName = `"` + groupNames[this.selectedTab] + `"`;
        if (this.groupMembers.length > 0) {
            this.groupMembersMarkup = this.groupMembers
                .map(member => `<group-member data-presenter="group-member" data-username="${member.username}" data-group="${member.group}" data-userDID="${member.DID}" data-groupDID="${member.groupDID}"></group-member>`)
                .join("");
        } else {
            this.groupMembersMarkup = `<div class="empty-group-container">There are no members in this group!</div>`;
        }

    }

    afterRender() {
        this.selectTab(this.selectedTab);
            const input = document.getElementById('member-did-text');
            const addMemberButton=document.getElementById('add-member-button');
            input.addEventListener('input', () => {
                if (input.value.trim() !== "") {
                    addMemberButton.disabled = false;
                } else {
                    addMemberButton.disabled = true;
                }
            });
    }

    changeTab(_target, groupId) {
        const currentSelectedTab = this.element.querySelector('.selected');
        if (currentSelectedTab) {
            currentSelectedTab.classList.remove('selected');
        }
        this.selectedTab = groupId;
        this.invalidate(async () => {
            this.groupMembers = await this.getGroupData(groupId)
        });
    }

    selectTab(groupId) {
        const selectedTab = this.element.querySelector(`#${groupId}`);
        selectedTab?.classList.add('selected');
    }
    async paste(_target){
        window.focus();
        try {
            const input = document.getElementById('member-did-text');
            const text = await navigator.clipboard.readText();
            const pasteLocation=this.element.querySelector('#member-did-text');
            pasteLocation.value=text;
            input.dispatchEvent(new Event('input'));
        } catch (err) {
            console.error('Failed to read clipboard contents: ', err);
        }
    }
    async addMember(_target){


    }

    async removeMember(_target){
        const memberToRemove=webSkel.reverseQuerySelector(_target,'group-member');
        memberToRemove.remove();
        //this.invalidate();
    }
    async openDataRecoveryKeyModal(_target){
        const modal= await webSkel.showModal("data-recovery-key-modal");
    }
}